{"version":3,"file":"primitive-type-checker.js","sources":["../node_modules/@actualwave/hasOwn/hasOwn.js","../source/index.js"],"sourcesContent":["const hasOwn = (\n  (has) =>\n  (target, property) =>\n  Boolean(target && has.call(target, property))\n)(Object.prototype.hasOwnProperty);\n\nexport default hasOwn;","import hasOwn from '@actualwave/hasOwn';\n\nimport {\n  MERGE,\n  ARGUMENTS,\n  GET_PROPERTY,\n  RETURN_VALUE,\n  SET_PROPERTY,\n  buildPath,\n  AsIs,\n  checkPrimitiveType,\n} from '@actualwave/primitive-type-checker/utils';\n\nexport const mergeConfigs = ({ types, errorReporter }, source, names = []) => {\n  const sourceTypes = source.types;\n\n  for (const name in sourceTypes) {\n    if (hasOwn(sourceTypes, name)) {\n      const sourceType = sourceTypes[name];\n      const targetType = types[name];\n\n      if (sourceType && targetType && targetType !== sourceType) {\n        errorReporter(\n          MERGE,\n          buildPath([...names, name]),\n          targetType,\n          sourceType,\n        );\n      } else {\n        types[name] = sourceType;\n      }\n    }\n  }\n\n  return { types, errorReporter };\n};\n\nexport const getTypeString = (value) => {\n  if (value === undefined) {\n    return '';\n  } else if (value instanceof Array) {\n    return 'array';\n  }\n\n  return typeof value;\n};\n\nexport const propertyCheckerFactory = (action) => {\n  function checkValueType(target, name, value, config, sequence) {\n    const { types, errorReporter } = config;\n    const type = this.getTypeString(value);\n\n    return checkPrimitiveType(\n      action,\n      types,\n      name,\n      type,\n      errorReporter,\n      sequence,\n    );\n  }\n\n  return checkValueType;\n};\n\nconst getPropertyChecker = propertyCheckerFactory(GET_PROPERTY);\nconst setPropertyChecker = propertyCheckerFactory(SET_PROPERTY);\n\nclass PrimitiveTypeChecker {\n  collectTypesOnInit = true;\n  getTypeString = getTypeString;\n  mergeConfigs = mergeConfigs;\n\n  init(target, errorReporter, cachedTypes = null) {\n    let types = {};\n\n    if (cachedTypes) {\n      types = cachedTypes;\n    } else if (this.collectTypesOnInit) {\n      Object.keys(target).forEach((key) => {\n        types[key] = getTypeString(target[key]);\n      });\n    }\n\n    return {\n      types,\n      errorReporter,\n    };\n  }\n\n  getProperty(target, name, value, config, sequence) {\n    return getPropertyChecker.call(this, target, name, value, config, sequence);\n  }\n\n  setProperty(target, name, value, config, sequence) {\n    return setPropertyChecker.call(this, target, name, value, config, sequence);\n  }\n\n  arguments(target, thisArg, args, config, sequence) {\n    const { types, errorReporter } = config;\n\n    const { length } = args;\n    let valid = true;\n\n    for (let index = 0; index < length; index++) {\n      const type = this.getTypeString(args[index]);\n      const agrValid = checkPrimitiveType(\n        ARGUMENTS,\n        types,\n        String(index),\n        type,\n        errorReporter,\n        sequence,\n      );\n\n      valid = agrValid && valid;\n    }\n\n    return valid;\n  }\n\n  returnValue(target, thisArg, value, config, sequence) {\n    const { types, errorReporter } = config;\n    const type = this.getTypeString(value);\n\n    return checkPrimitiveType(\n      RETURN_VALUE,\n      types,\n      AsIs(RETURN_VALUE),\n      type,\n      errorReporter,\n      sequence,\n    );\n  }\n}\n\nexport default PrimitiveTypeChecker;\n"],"names":["mergeConfigs","types","errorReporter","source","names","sourceTypes","name","hasOwn","sourceType","targetType","MERGE","buildPath","getTypeString","value","undefined","Array","propertyCheckerFactory","action","checkValueType","target","config","sequence","type","checkPrimitiveType","getPropertyChecker","GET_PROPERTY","setPropertyChecker","SET_PROPERTY","PrimitiveTypeChecker","collectTypesOnInit","cachedTypes","keys","forEach","key","call","thisArg","args","length","valid","index","agrValid","ARGUMENTS","String","RETURN_VALUE","AsIs"],"mappings":"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"}